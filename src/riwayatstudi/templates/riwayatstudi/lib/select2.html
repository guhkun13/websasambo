<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
    var urlProvinsi = "https://ibnux.github.io/data-indonesia/propinsi.json";
    var urlKabupaten = "https://ibnux.github.io/data-indonesia/kabupaten/";

    console.log('url: ' + urlProvinsi);
    $.getJSON(urlProvinsi, function (res) {
        console.log("INSIDE FUNC");
        //console.log(res);

        var data = $.map(res, function (obj) {
            obj.text = obj.nama

            return obj;
        });
        //console.log(data);
        loadProvinsi(data);
    });

    function fetchDataKabupaten(idProvinsi) {
        let url = urlKabupaten + idProvinsi + ".json";
        console.log('url kab : ' + url);
        $.getJSON(url, function (res) {
            console.log("INSIDE FUNC Kabupaten");
            //console.log(res);

            var data = $.map(res, function (obj) {
                obj.text = obj.nama

                return obj;
            });
            //console.log(data);
            loadKabupaten(data);
        });
    }


    function loadProvinsi(data) {
        console.log('loadProvinsi');
        $("#select2-provinsi").select2({
            dropdownAutoWidth: true,
            width: '100%',
            data: data
        })
    };

    function loadKabupaten(data) {
        console.log('loadKabupaten');
        $("#select2-kabupaten").select2({
            dropdownAutoWidth: true,
            width: '100%',
            data: data
        })
    };

    function clearOptions(id) {
        console.log("on clearOptions");

        //$('#' + id).val(null);
        $('#' + id).empty().trigger('change');
    }

    function assignValueToID(id, newValue) {
        console.log('on assignNewValue: ', id, '=>', newValue);
        $('#' + id).val(newValue);
    }

    function getValueFromID(id) {
        console.log('on getValueFromID: ', id);
        var res = $('#' + id).val();
        console.log('res: ', res);

        return res;
    }

    var fieldProvinsi = 'hiddenProvinsi';
    var selectProv = $('#select2-provinsi');
    $(selectProv).change(function () {
        console.log("on change selectProv");

        var value = $(selectProv).val();
        var text = $('#select2-provinsi :selected').text();
        console.log("value = " + value + " / " + "text = " + text);

        var tempNewValue = value + '|' + text;
        assignValueToID(fieldProvinsi, tempNewValue);
        var newValue = getValueFromID(fieldProvinsi);
        console.log("newValue = " + newValue);

        clearOptions('select2-kabupaten');
        dataKabupaten = fetchDataKabupaten(value);
        loadKabupaten(dataKabupaten);

    });

    var fieldKabupaten = 'hiddenKabupaten';
    var selectKab = $('#select2-kabupaten');
    $(selectKab).change(function () {
        console.log("on change selectKab");

        var value = $(this).val();
        var text = $('#select2-kabupaten :selected').text();
        console.log("value = " + value + " / " + "text = " + text);

        var tempNewValue = value + '|' + text;
        assignValueToID(fieldKabupaten, tempNewValue);
        var newValue = getValueFromID(fieldKabupaten);
        console.log("newValue = " + newValue);
    });
</script>